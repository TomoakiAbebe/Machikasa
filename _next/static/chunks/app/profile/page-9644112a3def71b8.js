(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{14681:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>a,Ou:()=>l});var s=r(95155);function a(e){let{size:t="md",color:r="blue",text:a}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-2",children:[(0,s.jsx)("div",{className:"".concat({sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[t]," ").concat({blue:"border-blue-600 border-t-transparent",white:"border-white border-t-transparent",gray:"border-gray-600 border-t-transparent"}[r]," border-2 rounded-full animate-spin"),role:"status","aria-label":"読み込み中"}),a&&(0,s.jsx)("div",{className:"text-sm ".concat("white"===r?"text-white":"text-gray-600"),children:a})]})}function l(e){let{text:t="読み込み中..."}=e;return(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)(a,{text:t})})}},20063:(e,t,r)=>{"use strict";var s=r(47260);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},20908:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(71847).A)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},23511:(e,t,r)=>{"use strict";r.d(t,{I:()=>i});var s=r(95155),a=r(12115),l=r(20908);function n(e){let{content:t,children:r,position:l="top"}=e,[n,i]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onTouchStart:()=>i(!0),onTouchEnd:()=>i(!1),children:[r,n&&(0,s.jsxs)("div",{className:"absolute z-50 ".concat({top:"bottom-full left-1/2 transform -translate-x-1/2 mb-2",bottom:"top-full left-1/2 transform -translate-x-1/2 mt-2",left:"right-full top-1/2 transform -translate-y-1/2 mr-2",right:"left-full top-1/2 transform -translate-y-1/2 ml-2"}[l]),children:[(0,s.jsx)("div",{className:"bg-gray-800 text-white text-sm px-3 py-2 rounded-lg shadow-lg max-w-xs",children:t}),(0,s.jsx)("div",{className:"absolute w-0 h-0 border-4 ".concat({top:"top-full left-1/2 transform -translate-x-1/2 border-l-transparent border-r-transparent border-b-transparent border-t-gray-800",bottom:"bottom-full left-1/2 transform -translate-x-1/2 border-l-transparent border-r-transparent border-t-transparent border-b-gray-800",left:"left-full top-1/2 transform -translate-y-1/2 border-t-transparent border-b-transparent border-r-transparent border-l-gray-800",right:"right-full top-1/2 transform -translate-y-1/2 border-t-transparent border-b-transparent border-l-transparent border-r-gray-800"}[l])})]})]})}function i(e){let{content:t}=e;return(0,s.jsx)(n,{content:t,children:(0,s.jsx)(l.A,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})})}},25016:(e,t,r)=>{"use strict";function s(e){return new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function a(e){return e.substring(0,5)}function l(e){switch(e){case"available":return"利用可能";case"in_use":return"使用中";case"maintenance":return"メンテナンス";case"lost":return"紛失";default:return"不明"}}function n(e){switch(e){case"good":return"良好";case"fair":return"普通";case"poor":return"要修理";default:return"不明"}}function i(e){switch(e){case"student":return"学生";case"store":return"店舗";case"admin":return"管理者";default:return"不明"}}function c(){let e=["次の人のためにありがとう☂️","素晴らしい！地域の輪を広げています\uD83C\uDF1F","お疲れさまでした！ポイントが加算されました✨","ご利用ありがとうございました\uD83D\uDE4F","みんなで支える街づくり、感謝です\uD83D\uDC99","傘シェアコミュニティの一員として感謝！\uD83E\uDD1D","雨の日を支えてくれてありがとう\uD83C\uDF27️","返却完了！次回もよろしくお願いします\uD83D\uDE0A"];return e[Math.floor(Math.random()*e.length)]}function d(e){return/^machikasa:\/\/umbrella\/[\w-]+$/.test(e)}function o(e){let t=e.match(/^machikasa:\/\/umbrella\/([\w-]+)$/);return t?t[1]:null}r.d(t,{Di:()=>s,KB:()=>n,VB:()=>l,Vw:()=>i,Xw:()=>o,fU:()=>a,pK:()=>c,w7:()=>d})},36066:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(95155),a=r(12115),l=r(20063),n=r(7685),i=r(25016),c=r(14681);function d(e){let{icon:t="\uD83D\uDCED",title:r,description:a,action:l}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4 opacity-50",children:t}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r}),(0,s.jsx)("p",{className:"text-gray-600 mb-6 max-w-sm",children:a}),l&&(0,s.jsx)("button",{onClick:l.onClick,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:l.label})]})}function o(e){let{onStartUsing:t}=e;return(0,s.jsx)(d,{icon:"\uD83C\uDF02",title:"取引履歴がありません",description:"まだ傘の借用・返却を行っていません。QRコードをスキャンして利用を開始しましょう。",action:t?{label:"QRスキャンを開始",onClick:t}:void 0})}var x=r(23511);function m(){let e=(0,l.useRouter)(),[t,r]=(0,a.useState)(null),[d,m]=(0,a.useState)([]),[u,h]=(0,a.useState)(!0),[g,b]=(0,a.useState)({currentlyBorrowed:0,totalBorrows:0,totalReturns:0,points:0,streak:0});if((0,a.useEffect)(()=>{(async()=>{h(!0),n.I.initialize();let e=n.I.getCurrentUser();if(r(e),e){m(n.I.getUserTransactions(e.id,5));let t=n.I.getUmbrellas().filter(t=>t.borrowedBy===e.id).length,r=n.I.getUserTransactions(e.id).filter(e=>"return"===e.action).slice(0,10),s=0;for(let e of r)if("return"===e.action)s++;else break;b({currentlyBorrowed:t,totalBorrows:e.totalBorrows,totalReturns:e.totalReturns,points:e.points,streak:s})}h(!1)})()},[]),u||!t)return(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:(0,s.jsx)(c.Ou,{text:"プロフィール情報を読み込み中..."})});let p=100*Math.ceil(t.points/100),j=t.points%100;return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"\uD83D\uDC64 プロフィール"}),(0,s.jsx)("p",{className:"text-gray-600",children:"あなたのMachikasaアカウント情報"})]}),(0,s.jsx)("button",{onClick:()=>{let e=n.I.getUsers(),s=(e.findIndex(e=>e.id===(null==t?void 0:t.id))+1)%e.length,a=e[s];n.I.setCurrentUser(a),r(a),m(n.I.getUserTransactions(a.id)),b({currentlyBorrowed:n.I.getUmbrellas().filter(e=>e.borrowedBy===a.id).length,totalBorrows:a.totalBorrows,totalReturns:a.totalReturns,points:a.points,streak:0})},className:"bg-blue-100 text-blue-800 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors text-sm",children:"\uD83D\uDD04 ユーザー切替 (デモ)"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-umbrella-blue rounded-full flex items-center justify-center text-white text-2xl font-bold",children:t.nameJa.charAt(0)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:t.nameJa}),(0,s.jsx)("p",{className:"text-gray-600",children:t.name}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("student"===t.role?"bg-blue-100 text-blue-800":"admin"===t.role?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),children:(0,i.Vw)(t.role)}),t.studentId&&(0,s.jsxs)("span",{className:"text-gray-600 text-sm",children:["ID: ",t.studentId]})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"メール:"}),(0,s.jsx)("span",{className:"ml-2",children:t.email})]}),t.phone&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"電話:"}),(0,s.jsx)("span",{className:"ml-2",children:t.phone})]}),t.department&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"所属:"}),(0,s.jsx)("span",{className:"ml-2",children:t.department})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-600",children:"登録日:"}),(0,s.jsx)("span",{className:"ml-2",children:(0,i.Di)(t.createdAt)})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-umbrella-blue mb-2",children:g.points}),(0,s.jsx)("div",{className:"text-gray-600",children:"現在のポイント"}),(0,s.jsx)("div",{className:"mt-2 bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-umbrella-blue h-2 rounded-full transition-all duration-500",style:{width:"".concat(j,"%")}})}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["次のレベルまで ",p-g.points,"pt"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-return-green mb-2",children:g.totalBorrows}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"総貸出回数"}),(0,s.jsx)(x.I,{content:"これまでに傘を借りた合計回数です。利用頻度の指標になります。"})]}),g.currentlyBorrowed>0&&(0,s.jsxs)("div",{className:"text-sm text-orange-600 mt-1",children:["現在 ",g.currentlyBorrowed,"本 使用中"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-warning-amber mb-2",children:g.totalReturns}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"総返却回数"}),(0,s.jsx)(x.I,{content:"これまでに傘を返却した合計回数です。責任ある利用の証です。"})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["返却率: ",g.totalBorrows>0?Math.round(g.totalReturns/g.totalBorrows*100):0,"%"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:g.streak}),(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"連続返却回数"}),(0,s.jsx)(x.I,{content:"最近の取引で連続して傘を返却した回数です。高い数値は信頼性の証です。"})]}),g.streak>=5&&(0,s.jsx)("div",{className:"text-sm text-purple-600 mt-1",children:"\uD83C\uDFC6 素晴らしい！"})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"最近の利用履歴 (直近5件)"}),0===d.length?(0,s.jsx)(o,{onStartUsing:()=>e.push("/scan")}):(0,s.jsxs)("div",{className:"space-y-3",children:[d.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:"borrow"===e.action?"\uD83D\uDCE4":"\uD83D\uDCE5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"borrow"===e.action?"傘を借りました":"傘を返却しました"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,i.Di)(e.timestamp)," | 傘ID: ",e.umbrellaId]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[e.pointsEarned&&(0,s.jsxs)("span",{className:"text-return-green font-medium",children:["+",e.pointsEarned,"pt"]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.weather&&"天気: ".concat(e.weather)})]})]},e.id)),n.I.getUserTransactions((null==t?void 0:t.id)||"").length>5&&(0,s.jsx)("div",{className:"text-center pt-4",children:(0,s.jsxs)("button",{className:"text-umbrella-blue hover:text-blue-600 font-medium",children:["さらに表示 (",n.I.getUserTransactions((null==t?void 0:t.id)||"").length-5,"件)"]})})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"\uD83C\uDFC6 実績・バッジ"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,s.jsx)("div",{className:"p-4 rounded-lg border-2 ".concat(g.totalBorrows>=1?"border-green-300 bg-green-50":"border-gray-200 bg-gray-50"),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDE80"}),(0,s.jsx)("div",{className:"font-medium",children:"初回利用"}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"最初の傘を借りる"}),g.totalBorrows>=1&&(0,s.jsx)("div",{className:"text-green-600 text-sm mt-1",children:"✅ 達成済み"})]})}),(0,s.jsx)("div",{className:"p-4 rounded-lg border-2 ".concat(g.totalReturns>=5?"border-green-300 bg-green-50":"border-gray-200 bg-gray-50"),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl mb-2",children:"\uD83C\uDF1F"}),(0,s.jsx)("div",{className:"font-medium",children:"コミュニティサポーター"}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"5回返却する"}),g.totalReturns>=5?(0,s.jsx)("div",{className:"text-green-600 text-sm mt-1",children:"✅ 達成済み"}):(0,s.jsxs)("div",{className:"text-gray-500 text-sm mt-1",children:[g.totalReturns,"/5"]})]})}),(0,s.jsx)("div",{className:"p-4 rounded-lg border-2 ".concat(g.points>=100?"border-green-300 bg-green-50":"border-gray-200 bg-gray-50"),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDC8E"}),(0,s.jsx)("div",{className:"font-medium",children:"ポイントコレクター"}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"100ポイント獲得"}),g.points>=100?(0,s.jsx)("div",{className:"text-green-600 text-sm mt-1",children:"✅ 達成済み"}):(0,s.jsxs)("div",{className:"text-gray-500 text-sm mt-1",children:[g.points,"/100"]})]})})]})]})]})}},71847:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var s=r(12115);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:d="",children:o,iconNode:x,...m}=e;return(0,s.createElement)("svg",{ref:t,...n,width:a,height:a,stroke:r,strokeWidth:c?24*Number(i)/Number(a):i,className:l("lucide",d),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...x.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(o)?o:[o]])}),c=(e,t)=>{let r=(0,s.forwardRef)((r,n)=>{let{className:c,...d}=r;return(0,s.createElement)(i,{ref:n,iconNode:t,className:l("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...d})});return r.displayName=a(e),r}},86526:(e,t,r)=>{Promise.resolve().then(r.bind(r,36066))}},e=>{e.O(0,[685,441,493,358],()=>e(e.s=86526)),_N_E=e.O()}]);